<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:configurator="http://cocoon.apache.org/schema/configurator"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd
    http://cocoon.apache.org/schema/configurator http://cocoon.apache.org/schema/configurator/cocoon-configurator-1.0.1.xsd">

	<bean id="PoLicenceInterceptor" class="at.workflow.webdesk.po.impl.PoLicenceInterceptor">

		<property name="sessionFactory" ref="sessionFactory"/>
		<property name="licenceActionService" ref="PoLicenceActionService"/>
	    <property name="licenceHelper" ref="PoLicenceHelper"/>
	    <property name="licenceReader" ref="LicenceReader"/>
	    <property name="mailService" ref="PoMailService"/>
	    <property name="scriptingService" ref="PoScriptingService"/>
	    <property name="languageService" ref="PoLanguageService"/>
        
		<property name="methodsToCheck">
			<map>
				<entry key="updatePerson" value-ref="PoLicenceConfigUpdatePerson"/>
				<entry key="savePerson" value-ref="PoLicenceConfigSavePerson"/>
				<entry key="saveAction" value-ref="PoLicenceConfigSaveAction"/>
				<entry key="linkPerson2Group" value-ref="PoLicenceConfigDummy"/>
				<entry key="changeValidityPersonGroupLink" value-ref="PoLicenceConfigDummy"/>
				<entry key="saveGroup" value-ref="PoLicenceConfigDummy"/>
				<entry key="setParentGroup" value-ref="PoLicenceConfigDummy"/>
				<entry key="saveRoleHolder" value-ref="PoLicenceConfigDummy"/>
				<entry key="assignRole" value-ref="PoLicenceConfigDummy"/>
				<entry key="assignRoleWithPersonCompetence" value-ref="PoLicenceConfigDummy"/>
				<entry key="assignRoleWithGroupCompetence" value-ref="PoLicenceConfigDummy"/>
				<entry key="assignPermission" value-ref="PoLicenceConfigAddPersonToAction"/>
				<entry key="assignPermissionWithCompetenceTargets" value-ref="PoLicenceConfigAddPersonToActionWithCompetenceList"/>
				
				<!--  deprecated method calls -->
				<entry key="addClientToAction" value-ref="PoLicenceConfigDummy"/>
				<entry key="addGroupToAction" value-ref="PoLicenceConfigDummy"/>
				<entry key="addGroupToActionWithCompetenceList" value-ref="PoLicenceConfigDummy"/>
				<entry key="addPersonToAction" value-ref="PoLicenceConfigAddPersonToAction"/>
				<entry key="addPersonToActionWithCompetenceList" value-ref="PoLicenceConfigAddPersonToActionWithCompetenceList"/>
				<entry key="addRoleToAction" value-ref="PoLicenceConfigDummy"/>
			</map>
		</property>
		<property name="settings" ref="org.apache.cocoon.configuration.Settings"/>
		<property name="tresholdFactor" value="0.95"/>
		<property name="sendMailToLicenceManagerIfTresholdReached" value="true"/>
		<property name="licenceManagerEmail" value=""/>
	</bean>
	
	<bean id="PoLicenceHelper"  class="at.workflow.webdesk.po.impl.licence.LicenceHelperImpl"/>
    
    <!-- defines NO heuristic to avoid the check -->
    <bean id="PoLicenceConfigDummy" class="at.workflow.webdesk.po.impl.licence.PoLicenceCheckOfAction"/>
    
    <!-- defines some heuristics for some methods to avoid the real expensive check -->
    <bean id="PoLicenceConfigUpdatePerson" class="at.workflow.webdesk.po.impl.licence.PoLicenceCheckOfAction">
        <property name="name" value="updatePerson"/>
        <property name="beanNameOfCheckNec" value="PoOrganisationService"/>
        <property name="methodNameOfCheckNec" value="checkNeededForUpdatePerson"/>
    </bean>
	
    <bean id="PoLicenceConfigSavePerson" class="at.workflow.webdesk.po.impl.licence.PoLicenceCheckOfAction">
        <property name="name" value="savePerson"/>
        <property name="beanNameOfCheckNec" value="PoOrganisationService"/>
        <property name="methodNameOfCheckNec" value="checkNeededForSavePerson"/>
    </bean>
    
    <bean id="PoLicenceConfigSaveAction" class="at.workflow.webdesk.po.impl.licence.PoLicenceCheckOfAction">
        <property name="name" value="saveAction"/>
        <property name="beanNameOfCheckNec" value="PoLicenceCheckHeuristic"/>
        <property name="methodNameOfCheckNec" value="fullLicenceCheckNeeded"/>
    </bean>
    
    <bean id="PoLicenceConfigAddPersonToAction" class="at.workflow.webdesk.po.impl.licence.PoLicenceCheckOfAction">
        <property name="name" value="assignPermission"/>
    </bean>

    <bean id="PoLicenceConfigAddPersonToActionWithCompetenceList" class="at.workflow.webdesk.po.impl.licence.PoLicenceCheckOfAction">
        <property name="name" value="assignPermissionWithCompetenceTargets" />
    </bean>
    
    <bean id="PoLicenceCheckHeuristic" class="at.workflow.webdesk.po.impl.licence.PoLicenceCheckHeuristic"/>


</beans>